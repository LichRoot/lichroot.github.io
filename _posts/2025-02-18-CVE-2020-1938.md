---
title: "Exploiting TomGhost (CVE 2020–1938) - TryHackMe"
date: 2025-01-04
categories: [TryHackMe, CVE]
tags: [Tomcat, Ghostcat, CVE 2020-1938, Pentesting, Exploit]
---

## Descrição do Desafio

Esta sala aborda a exploração de uma vulnerabilidade crítica no Tomcat, conhecida como **Ghostcat (CVE 2020–1938)**. Durante o desafio, exploramos a descriptografia de chaves PGP e ASC, além de realizar uma escalada de privilégio utilizando arquivos ZIP.

---

## Enumeração

![Imagem de enumeração](images/CVE-2020-1938/1.png)

As portas 22, 53, 8009 e 8080 estão abertas. Na porta 8080, encontramos a página padrão do Apache Tomcat. Em cenários normais, a primeira tentativa seria acessar o Manager App e tentar carregar um arquivo WAR malicioso para exploração. Contudo, aqui não temos permissão para tal.

![Imagem de Tomcat](images/CVE-2020-1938/2.png)

A versão identificada é 9.0.30, e na porta 8009, encontramos um serviço chamado Apache JServ Protocol v1.3. Pesquisando mais sobre isso, descobrimos uma vulnerabilidade chamada Ghostcat.

> Consulte o [Exploit-DB](https://www.exploit-db.com/exploits/48143) para mais detalhes.

A exposição da porta AJP pode tornar o Tomcat vulnerável à vulnerabilidade Ghostcat, que é um tipo de LFI (Local File Inclusion). Embora restrita, essa vulnerabilidade pode permitir o acesso a arquivos como o `WEB-INF/web.xml`, que pode conter informações confidenciais, como credenciais da interface administrativa do Tomcat.

Consulte também este [site HackTricks - Pentesting Apache JServ Protocol AJP](https://hacktricks.boitatech.com.br/pentesting/8009-pentesting-apache-jserv-protocol-ajp) para detalhes sobre a exploração.

![Imagem da vulnerabilidade](images/CVE-2020-1938/3.png)

---

## Execução do Exploit

Após a execução do exploit, obtemos uma saída que parece conter um nome de usuário e senha. Como não temos uma página de login, usamos o SSH para tentar acessar com as credenciais, e funcionou.

![Imagem da execução](images/CVE-2020-1938/4.png)

Ao listar os arquivos, encontramos dois arquivos importantes: `credentials.pgp` e `tryhackme.asc`. O arquivo PGP está criptografado, então transferimos ambos para nossa máquina para proceder com a descriptografia.

Utilizamos SCP para a transferência, mas também é possível usar o SimpleHttpServer do Python.

![Imagem de transferência](images/CVE-2020-1938/5.png)

---

## Quebrando PGP & ASC

Para quebrar a criptografia dos arquivos, inicialmente não sabia como lidar com os formatos ASC e PGP, então fizemos algumas pesquisas. Encontramos ferramentas como o `john` e `gpg2john` para quebrar essas chaves. O arquivo ASC contém a senha necessária para acessar o PGP.

Após rodarmos o `gpg2john`, utilizamos o `john` com o arquivo `rockyou.txt`, e conseguimos quebrar a senha.

![Imagem de quebra de senha](images/CVE-2020-1938/6.png)

A senha descoberta foi `alexandru`.

![Imagem de senha](images/CVE-2020-1938/7.png)

Usamos essa senha para descriptografar o arquivo GPG, obtendo as credenciais do usuário: `merlin` e uma senha longa. Com isso, realizamos um novo acesso via SSH.

![Imagem de acesso](images/CVE-2020-1938/8.png)

---

## Escalada de Privilégio

![Imagem de escalada de privilégio](images/CVE-2020-1938/10.png)

Executamos o comando `sudo -l` para verificar quais comandos podíamos rodar como root. Descobrimos que tínhamos permissões para rodar o comando `zip` como root. Pesquisamos sobre o uso do `zip` com privilégios elevados no GTFOBins, e aplicamos a técnica para escalar os privilégios.

![Imagem de escalada](images/CVE-2020-1938/11.png)

Após executar os comandos necessários, conseguimos obter acesso root!

---

Este artigo aborda como exploramos a vulnerabilidade **Ghostcat (CVE 2020–1938)** e como ela pode ser utilizada em testes de penetração para comprometer sistemas com o Apache Tomcat. 

Espero que tenha sido útil para entender melhor o CVE Ghostcat e como ele pode ser explorado na prática.

---
